<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <title>Real Estate Admin Dashboard</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Bootstrap CSS --> 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"> <!-- Google Fonts --> 
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet"> 
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      overflow-x: hidden;
      background-color: #000;
      color: #FFD700;
    }
    /* Sidebar Styles */
    #sidebar {
      min-width: 250px;
      max-width: 250px;
      background: #000;
      border-right: 1px solid #FFD700;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      overflow-y: auto;
    }
    #sidebar h4 {
      color: #FFD700;
      margin: 0;
      padding: 20px;
      text-align: center;
      background: #111;
      border-bottom: 1px solid #FFD700;
    }
    #sidebar .nav-link {
      color: #FFD700;
      padding: 15px 20px;
      border-bottom: 1px solid #222;
      transition: background 0.3s;
      cursor: pointer;
    }
    #sidebar .nav-link:hover, #sidebar .nav-link.active {
      background: #FFD700;
      color: #000;
    }
    /* Content Area */
    #content {
      margin-left: 250px;
      padding: 20px;
    }
    /* Navbar */
    .navbar {
      background-color: #111;
      border-bottom: 1px solid #FFD700;
    }
    .navbar .navbar-brand,
    .navbar-nav .nav-link {
      color: #FFD700 !important;
    }
    /* Cards and Table */
    .card {
      background-color: #111;
      border: 1px solid #FFD700;
      margin-bottom: 20px;
    }
    .card-header {
      background-color: #000;
      color: #FFD700;
      border-bottom: 1px solid #FFD700;
    }
    .card-body {
      background-color: #111;
      color: #FFD700;
    }
    .table {
      background-color: #111;
      color: #FFD700;
    }
    .table-striped tbody tr:nth-of-type(odd) {
      background-color: #222;
    }
    /* Form Controls */
    input, textarea, select {
      background-color: #222;
      color: #FFD700;
      border: 1px solid #FFD700;
    }
    input:focus, textarea:focus, select:focus {
      box-shadow: none;
      border-color: #FFD700;
    }
    button {
      border: 1px solid #FFD700;
      transition: background 0.3s, color 0.3s;
    }
    button:hover {
      background: #FFD700;
      color: #000;
    }
    /* Image Preview */
    #imagePreview img {
      max-width: 100px;
      margin: 5px;
      border: 1px solid #FFD700;
      border-radius: 4px;
    }
    /* Responsive adjustments */
    @media (max-width: 768px) {
      #sidebar {
        position: relative;
        width: 100%;
        height: auto;
      }
      #content {
        margin-left: 0;
      }
    }
  </style> 
 </head> 
 <body> 
  <div id="sidebar"> 
   <h4>Admin Panel</h4> 
   <nav class="nav flex-column"> <a class="nav-link active" data-bs-toggle="pill" href="#dashboard">Dashboard</a> <a class="nav-link" data-bs-toggle="pill" href="#properties">Properties</a> 
   </nav> 
  </div> 
  <div id="content"> 
   <nav class="navbar navbar-expand-lg"> 
    <div class="container-fluid"> <span class="navbar-brand mb-0 h1">Real Estate Admin</span> 
     <ul class="navbar-nav ms-auto"> 
      <li class="nav-item"><a class="nav-link" href="#">Home</a></li> 
      <li class="nav-item"><a class="nav-link" href="#">Profile</a></li> 
      <li class="nav-item"><a class="nav-link" href="#">Logout</a></li> 
     </ul> 
    </div> 
   </nav> 
   <div class="tab-content mt-4"> <!-- Dashboard Section --> 
    <div class="tab-pane fade show active" id="dashboard"> 
     <div class="container"> 
      <h2 class="mb-4">Dashboard</h2> 
      <p>Welcome to your Real Estate Admin Dashboard.</p> 
     </div> 
    </div> <!-- Properties Section --> 
    <div class="tab-pane fade" id="properties"> 
     <div class="container"> 
      <h2 class="mb-4">Properties</h2> <!-- Properties List --> 
      <div class="card"> 
       <div class="card-header">
        Properties List
       </div> 
       <div class="card-body"> 
        <div class="table-responsive"> 
         <table class="table table-striped" id="propertiesTable"> 
          <thead> 
           <tr> 
            <th>Category</th> 
            <th>Description</th> 
            <th>Images</th> 
            <th>Location</th> 
            <th>Title</th> 
            <th>Price</th> 
            <th>Actions</th> 
           </tr> 
          </thead> 
          <tbody></tbody> 
         </table> 
        </div> 
       </div> 
      </div> <!-- Add / Edit Property Form --> 
      <div class="card"> 
       <div class="card-header">
        Add / Edit Property
       </div> 
       <div class="card-body"> 
        <form id="propertyForm"> 
         <div class="mb-3"> <label class="form-label">Category</label> 
          <input type="text" id="propertyCategory" class="form-control" required> 
         </div> 
         <div class="mb-3"> <label class="form-label">Description</label> <textarea id="propertyDescription" class="form-control" rows="3" required></textarea> 
         </div> 
         <div class="mb-3"> <label class="form-label">Upload Images (max 20)</label> 
          <input type="file" id="propertyImages" class="form-control" accept="image/*" multiple> 
          <div id="imagePreview" class="d-flex flex-wrap mt-2"></div> 
         </div> 
         <div class="mb-3"> <label class="form-label">Location</label> 
          <input type="text" id="propertyLocation" class="form-control" required> 
         </div> 
         <div class="mb-3"> <label class="form-label">Title</label> 
          <input type="text" id="propertyTitle" class="form-control" required> 
         </div> 
         <div class="mb-3"> <label class="form-label">Price</label> 
          <input type="number" id="propertyPrice" class="form-control" required> 
         </div> 
         <div class="d-flex"> <button type="submit" id="submitBtn" class="btn btn-success">Add Property</button> <button type="button" id="cancelEditBtn" class="btn btn-secondary ms-2" style="display:none;">Cancel</button> 
         </div> 
        </form> 
       </div> 
      </div> 
     </div> 
    </div><!-- End Properties Section --> 
   </div> 
  </div> <!-- Bootstrap JS bundle --> 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script> 
  <script>
    // Updated credentials
    const APP_ID       = '9F28C534-8DE5-4505-8E67-3D4C16FFDD63';
    const REST_API_KEY = '074FA8E4-7EA4-4EF3-83F8-74A692AE38ED';
    const BASE_URL     = `https://api.backendless.com/${APP_ID}/${REST_API_KEY}/data/Properties`;
    const FILE_FOLDER  = 'propertiesimages';

    let currentEditId    = null;
    let editingImageUrls = [];

    // Preview selected images
    document.getElementById('propertyImages').addEventListener('change', function() {
      const preview = document.getElementById('imagePreview');
      preview.innerHTML = '';
      const files = Array.from(this.files).slice(0, 20);
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement('img');
          img.src = e.target.result;
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
      if (this.files.length > 20) {
        alert('You can upload up to 20 images only. Extra files have been ignored.');
      }
    });

    // Fetch properties from Backendless
    async function fetchProperties() {
      try {
        const res  = await fetch(BASE_URL);
        const json = await res.json();
        const list = Array.isArray(json) ? json : (json.data || []);
        const tbody = document.querySelector('#propertiesTable tbody');
        tbody.innerHTML = '';
        list.forEach(p => {
          const tr = document.createElement('tr');
          // Build image links for each property
          const imgs = (p.imageurls || []).map(url =>
            `<a href="${url}" target="_blank" class="d-block">View</a>`
          ).join('');
          tr.innerHTML = `
            <td>${p.category || ''}</td>
            <td>${p.description || ''}</td>
            <td>${imgs}</td>
            <td>${p.location || ''}</td>
            <td>${p.title || ''}</td>
            <td>${p.price ? '$' + p.price : ''}</td>
            <td>
              <button class="btn btn-sm btn-primary me-1" onclick="startEdit('${p.objectId}')">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteProperty('${p.objectId}')">Delete</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      } catch (e) {
        console.error('Fetch error:', e);
        alert('Error fetching properties: ' + e.message);
      }
    }

    // Delete property
    async function deleteProperty(id) {
      if (!confirm('Delete this property?')) return;
      try {
        const res = await fetch(`${BASE_URL}/${id}`, { method: 'DELETE' });
        if (!res.ok) throw new Error(await res.text());
        alert('Property deleted.');
        if (currentEditId === id) resetForm();
        fetchProperties();
      } catch (err) {
        console.error('Delete error:', err);
        alert('Delete failed: ' + err.message);
      }
    }

    // Start editing a property
    async function startEdit(id) {
      try {
        const res  = await fetch(`${BASE_URL}/${id}`);
        if (!res.ok) throw new Error(await res.text());
        const data = await res.json();
        document.getElementById('propertyCategory').value    = data.category;
        document.getElementById('propertyDescription').value = data.description;
        document.getElementById('propertyLocation').value    = data.location;
        document.getElementById('propertyTitle').value       = data.title;
        document.getElementById('propertyPrice').value       = data.price;
        editingImageUrls = data.imageurls || [];
        // Preview existing images
        const preview = document.getElementById('imagePreview');
        preview.innerHTML = '';
        editingImageUrls.forEach(url => {
          const img = document.createElement('img');
          img.src = url;
          preview.appendChild(img);
        });
        currentEditId = id;
        document.getElementById('submitBtn').textContent = 'Update Property';
        document.getElementById('cancelEditBtn').style.display = 'inline-block';
        document.querySelector('a[href="#properties"]').click();
      } catch (err) {
        console.error('Edit load error:', err);
        alert('Could not load property: ' + err.message);
      }
    }

    // Reset form
    function resetForm() {
      currentEditId = null;
      editingImageUrls = [];
      document.getElementById('propertyForm').reset();
      document.getElementById('imagePreview').innerHTML = '';
      document.getElementById('submitBtn').textContent = 'Add Property';
      document.getElementById('cancelEditBtn').style.display = 'none';
    }

    // Handle form submit (Add / Edit)
    document.getElementById('propertyForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const cat   = document.getElementById('propertyCategory').value.trim();
      const desc  = document.getElementById('propertyDescription').value.trim();
      const loc   = document.getElementById('propertyLocation').value.trim();
      const tit   = document.getElementById('propertyTitle').value.trim();
      const pri   = parseFloat(document.getElementById('propertyPrice').value);
      const files = Array.from(document.getElementById('propertyImages').files).slice(0, 20);

      try {
        // Upload new files (if any)
        const newUrls = await Promise.all(files.map(async file => {
          const fileName  = Date.now() + '_' + file.name;
          const uploadUrl = `https://api.backendless.com/${APP_ID}/${REST_API_KEY}/files/${FILE_FOLDER}/${fileName}`;
          const fd = new FormData();
          fd.append('file', file);
          const upRes = await fetch(uploadUrl, { method: 'POST', body: fd });
          if (!upRes.ok) throw new Error(await upRes.text());
          const upData = await upRes.json();
          return upData.fileURL;
        }));

        // Combine with existing images (for edits)
        const allUrls = currentEditId
          ? [...editingImageUrls, ...newUrls].slice(0, 20)
          : newUrls;

        const payload = {
          category:    cat,
          description: desc,
          imageurls:   allUrls,
          location:    loc,
          title:       tit,
          price:       pri
        };

        let res;
        if (currentEditId) {
          res = await fetch(`${BASE_URL}/${currentEditId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
        } else {
          res = await fetch(BASE_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
        }

        if (!res.ok) throw new Error(await res.text());
        alert(currentEditId ? 'Property updated!' : 'Property added!');
        resetForm();
        fetchProperties();
      } catch (err) {
        console.error('Save error:', err);
        alert('Save failed: ' + err.message);
      }
    });

    document.addEventListener('DOMContentLoaded', fetchProperties);
  </script> 
 </body>
</html>










